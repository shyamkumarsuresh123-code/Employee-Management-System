<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Infotech - Portal Access</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; background-color: #f4f6f9; }

        /* FULL SCREEN SECTION STYLES */
        .full-screen-section {
            display: none; /* Hidden by default */
            height: 100vh;
            width: 100%;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s;
        }

        /* Show Management by default via JS */
        #management-section { background-color: #f8f9fa; color: #333; }
        #employee-section { background-color: #f8f9fa; color: #333; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- LOGO STYLE --- */
        .logo {
            width: 280px; 
            height: auto;
            margin-bottom: 25px;
            display: block;
            background-color: #0056b3; 
            padding: 15px 30px;
            border-radius: 50px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* --- TITLE STYLES --- */
        h1 { 
            margin-bottom: 10px; 
            color: #000000; 
            text-transform: uppercase; 
            letter-spacing: 1px;
            font-size: 1.8rem;
        }

        h2 { margin-bottom: 30px; }

        /* FORM STYLES */
        form { display: flex; flex-direction: column; gap: 15px; width: 320px; background: rgba(255,255,255,0.1); padding: 40px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #management-section form { background: white; border: 1px solid #ddd; }

        input { padding: 12px; border-radius: 5px; border: 1px solid #ccc; font-size: 14px; }

        /* BUTTONS */
        button { padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; color: white; transition: 0.3s; margin-top: 10px;}

        .btn-mgmt { background-color: #27ae60; }
        .btn-mgmt:hover { background-color: #219150; }

        .btn-emp { background-color: #27ae60; }
        .btn-emp:hover { background-color: #219150; }

        /* SWITCH BUTTONS */
        .switch-btn {
            background: transparent;
            border: 2px solid;
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 14px;
            color: #0056b3; 
            border-color: #0056b3; 
        }
        .switch-btn:hover { 
            background: #0056b3; 
            color: white; 
        }

        /* LINKS */
        a { color: #0056b3; text-decoration: none; font-weight: bold; }
        a:hover { text-decoration: underline; }

        /* MODAL STYLES */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
        .modal-content { background-color: white; margin: 5% auto; padding: 30px; border-radius: 10px; width: 400px; color: #333; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .close { float: right; font-size: 28px; font-weight: bold; cursor: pointer; color: #aaa; }
        .close:hover { color: #000; }
        .scroll-form { max-height: 400px; overflow-y: auto; padding-right: 10px; }
        .scroll-form input { width: 90%; margin-bottom: 5px;}
        
        /* Loading Spinner */
        #loading { display: none; text-align: center; margin-top: 10px; font-weight: bold; color: #0056b3; }
        
        /* DOB Label inside Modal */
        .dob-label {
            display: block;
            font-size: 13px;
            color: #666;
            margin-bottom: -10px;
            margin-left: 2px;
            text-align: left;
        }
    </style>
</head>
<body>

<div id="management-section" class="full-screen-section" style="display: flex;">
    <img src="aiinfo.webp" alt="AI Infotech Logo" class="logo">
    <h1>Management Portal</h1>

    <form onsubmit="handleLogin(event, 'management')">
        <label>Welcome Back!</label>
        <label>Enter User ID</label>
        <input type="text" id="mgmt-id" name="username" placeholder="Login ID" required>
        
        <label>Enter Password</label>
        <input type="password" id="mgmt-pass" name="password" placeholder="Password" required>
        
        <button type="submit" class="btn-mgmt">Login</button>
    </form>

    <button class="switch-btn" onclick="showEmployee()">
        Go to Employee Portal &rarr;
    </button>
</div>

<div id="employee-section" class="full-screen-section">
    <img src="aiinfo.webp" alt="AI Infotech Logo" class="logo">
    <h1>Employee Portal</h1>

    <form onsubmit="handleLogin(event, 'employee')">
        <label>Welcome Back!</label>
        <label>Enter User ID</label>
        <input type="text" id="emp-id" name="username" placeholder="Login ID" required>
        
        <label>Enter Password</label>
        <input type="password" id="emp-pass" name="password" placeholder="Password" required>
        
        <button type="submit" class="btn-emp">Login</button>
        <div id="loading">Checking Database...</div>
    </form>

    <p style="margin-top: 20px;">
        New Employee? <a href="#" onclick="openModal()">Register Here</a>
    </p>

    <button class="switch-btn" onclick="showManagement()">
        &larr; Back to Management
    </button>
</div>

<div id="regModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 style="text-align: center; margin-top: 0;">New Registration</h2>
        <form id="registrationForm" class="scroll-form">
            <input type="text" name="User Name" placeholder="User Name (Login ID)" required>
            <input type="text" name="First Name" placeholder="First Name" required>
            <input type="text" name="Last Name" placeholder="Last Name" required>
            <input type="email" name="Email" placeholder="Email" required>
            
            <label class="dob-label">Date Of Birth:</label>
            <input type="text" name="Date Of Birth" placeholder="Date of Birth (DD/MM/YYYY)" required>
            
            <input type="tel" name="Phone Number" placeholder="Phone Number" required>
            <input type="tel" name="Emergency Contact Number" placeholder="Emergency Contact Number" required>
            
            <input type="password" name="Password" placeholder="Password" required>
            
            <input type="password" name="confirmPassword" placeholder="Confirm Password" required>

            <button type="submit" class="btn-emp" style="margin-top: 10px;">Submit Registration</button>
            <div id="reg-loading" style="display:none; text-align:center; margin-top:5px;">Saving to Database...</div>
        </form>
    </div>
</div>

<script>
    // ==========================================
    // CONFIGURATION
    // ==========================================
    const SHEETDB_API_URL = 'https://sheetdb.io/api/v1/b53909p8ngawe'; 
    // ==========================================

    // 1. PAGE NAVIGATION FUNCTIONS
    window.showEmployee = function() {
        document.getElementById('management-section').style.display = 'none';
        document.getElementById('employee-section').style.display = 'flex';
    }

    window.showManagement = function() {
        document.getElementById('employee-section').style.display = 'none';
        document.getElementById('management-section').style.display = 'flex';
    }

    // Modal Handling
    window.openModal = function() { document.getElementById("regModal").style.display = "block"; }
    window.closeModal = function() { document.getElementById("regModal").style.display = "none"; }
    
    window.onclick = function(event) {
        if (event.target == document.getElementById("regModal")) { 
            window.closeModal(); 
        }
    }

    // 2. LOGIN HANDLING
    window.handleLogin = function(event, role) {
        event.preventDefault();
        
        if(role === 'management') {
            const id = document.getElementById('mgmt-id').value;
            const pass = document.getElementById('mgmt-pass').value;

            // Simple Admin Check
            if(id === "admin" && pass === "admin123") {
                sessionStorage.setItem("userRole", "admin");
                sessionStorage.setItem("userName", "Administrator");
                window.location.href = "management_dashboard.html";
            } else {
                alert("Invalid Management Credentials");
            }

        } else if(role === 'employee') {
            const id = document.getElementById('emp-id').value;
            const pass = document.getElementById('emp-pass').value;
            const loading = document.getElementById('loading');

            loading.style.display = 'block';

            // 1. Always Search Database FIRST
            fetch(`${SHEETDB_API_URL}/search?User Name=${encodeURIComponent(id)}`)
                .then(response => response.json())
                .then(data => {
                    loading.style.display = 'none';
                    
                    // Case A: User Found in Database
                    if (data.length > 0) {
                        const user = data[0]; 
                        
                        // We strictly use the database password here
                        if (user["Password"] === pass) {
                            sessionStorage.setItem("userRole", "employee");
                            sessionStorage.setItem("userName", user["User Name"]);
                            sessionStorage.setItem("fullName", `${user["First Name"]} ${user["Last Name"]}`);
                            window.location.href = "employee_dashboard.html";
                        } else {
                            alert("Incorrect Password (Database Record Found)");
                        }
                    } 
                    // Case B: User NOT Found in Database -> Check Default Hardcoded
                    else {
                        if(id === "employee" && pass === "employee123") {
                            sessionStorage.setItem("userRole", "employee");
                            sessionStorage.setItem("userName", "employee"); // Default ID
                            sessionStorage.setItem("fullName", "Demo Employee"); // Default Name
                            window.location.href = "employee_dashboard.html";
                        } else {
                            alert("User ID not found in Database");
                        }
                    }
                })
                .catch(error => {
                    loading.style.display = 'none';
                    console.error('Error:', error);
                    
                    // Fallback: If internet fails, allow default login if credentials match
                    if(id === "employee" && pass === "employee123") {
                        alert("Network Error. Logging in with Offline Default Credentials.");
                        sessionStorage.setItem("userRole", "employee");
                        sessionStorage.setItem("userName", "employee");
                        window.location.href = "employee_dashboard.html";
                    } else {
                        alert("Connection error. Please try again.");
                    }
                });
        }
    }

    // 3. REGISTRATION LOGIC
    const regForm = document.getElementById('registrationForm');
    
    regForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const formData = new FormData(regForm);
        const userData = Object.fromEntries(formData.entries());
        const loading = document.getElementById('reg-loading');

        // Check Passwords
        if(userData["Password"] !== userData["confirmPassword"]){
            alert("Passwords do not match!");
            return;
        }

        // Delete confirmPassword so it is NOT sent to the Google Sheet
        delete userData["confirmPassword"];
        
        loading.style.display = 'block';

        // POST request to SheetDB
        fetch(SHEETDB_API_URL, {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                data: [ userData ]
            })
        })
        .then(response => response.json())
        .then(data => {
            loading.style.display = 'none';
            if (data.created === 1) {
                alert("Registration Successful! You can now login.");
                regForm.reset();
                window.closeModal();
            } else if (data.error) {
                alert("Database Error: " + data.error);
            } else {
                alert("Registration Failed. Please verify that your Google Sheet Headers match the form fields exactly.");
            }
        })
        .catch(error => {
            loading.style.display = 'none';
            console.error("Error registering:", error);
            alert("Network Error: " + error.message);
        });
    });

</script>

</body>
</html>
