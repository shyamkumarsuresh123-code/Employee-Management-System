<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Dashboard - AI Infotech</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- General Reset --- */
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100%;
            background-color: #f4f6f9;
        }

        .wrapper { display: flex; height: 100vh; width: 100%; }

        /* --- SIDEBAR STYLING (Dark with Yellow Accents) --- */
        .sidebar {
            width: 260px;
            background-color: #212529; /* Darker Grey/Black */
            color: #ffffff;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            height: 100vh; /* Full Height */
        }

        .brand-logo {
            padding: 20px;
            text-align: center;
            background-color: #1a1e21;
            border-bottom: 1px solid #32383e;
            border-left: 5px solid #ffc107; /* Yellow Accent */
        }

        /* --- NEW LOGO STYLE --- */
        .sidebar-logo {
            max-width: 100%;    /* Ensures it stays within the sidebar width */
            height: auto;       /* Maintains aspect ratio */
            width: 180px;       /* Sets a reasonable size */
            display: block;
            margin: 0 auto;     /* Centers the logo */
        }

        /* NAVIGATION LINKS */
        /* flex-grow: 1 pushes the footer to the bottom */
        .nav-links {
            list-style: none;
            padding: 0;
            margin: 20px 0;
            flex-grow: 1;
            overflow-y: auto;
        }

        .nav-links li a, .nav-links summary {
            display: block;
            padding: 15px 20px;
            color: #adb5bd;
            text-decoration: none;
            transition: background 0.3s, color 0.3s;
            cursor: pointer;
            font-size: 1rem;
        }

        /* Hover State - Yellow Background, Black Text */
        .nav-links li a:hover, .nav-links summary:hover, .nav-links li a.active-link {
            background-color: #ffc107;
            color: #212529;
            font-weight: 600;
        }

        .nav-links i { width: 25px; text-align: center; margin-right: 10px; }

        details summary { list-style: none; outline: none; }
        details summary::after { content: '\25BC'; float: right; font-size: 0.8em; margin-top: 5px; }
        details[open] summary::after { content: '\25B2'; }

        .sub-menu { background-color: #32383e; padding-left: 0; margin: 0; list-style: none; }
        .sub-menu a { padding-left: 55px !important; font-size: 0.95rem; }

        /* --- SIDEBAR FOOTER (LOGOUT) --- */
        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid #32383e;
            background-color: #1a1e21;
        }

        .btn-logout {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 12px 0;
            background-color: transparent;
            color: #dc3545; /* Red Text */
            border: 1px solid #dc3545;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
            box-sizing: border-box; /* Ensures padding doesn't overflow width */
        }

        .btn-logout:hover {
            background-color: #dc3545;
            color: white;
        }

        /* --- MAIN CONTENT STYLING --- */
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Top Bar */
        .dashboard-top-bar {
            background-color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #ffc107; /* Yellow Line */
        }

        .welcome-msg h2 { margin: 0; font-size: 1.4rem; color: #333; }
        .welcome-msg p { margin: 5px 0 0 0; color: #666; font-size: 0.95rem; }

        .date-widget {
            background-color: #fff9db; /* Light Yellow bg */
            padding: 10px 20px;
            border-radius: 50px;
            border: 1px solid #ffeeba;
            display: flex;
            align-items: center;
            color: #856404;
            font-weight: 600;
        }
        .date-widget i { color: #d39e00; margin-right: 10px; }

        /* Container */
        .content-container { padding: 30px; }

        /* Utility: Hide sections */
        .section-view { display: none; animation: fadeIn 0.3s ease-in-out; }
        .section-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- DASHBOARD GRID --- */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-top: 4px solid #ffc107; /* Yellow Top Border */
            text-align: center;
        }

        .stat-card h4 { margin: 0; color: #666; font-size: 1rem; text-transform: uppercase; }
        .stat-card .count { font-size: 2.5rem; margin: 10px 0; color: #333; font-weight: bold; }

        .btn-view-more {
            background-color: #ffc107; /* Yellow Button */
            color: #212529; /* Black Text */
            border: none;
            padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: background 0.2s;
        }
        .btn-view-more:hover { background-color: #e0a800; }

        /* --- ATTENDANCE & REQUEST STYLES --- */
        .two-col-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .list-box { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .list-box h4 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; }

        .report-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 20px; }
        .report-card { background: #fff; padding: 20px; border-radius: 8px; text-align: center; border: 1px solid #eee; }
        .report-card h5 { margin: 0; color: #666; }
        .report-card p { font-size: 1.5rem; font-weight: bold; color: #333; margin: 10px 0; }

        /* Request Table style */
        .req-card {
            background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #ffc107;
        }
        .req-info h5 { margin: 0 0 5px 0; font-size: 1.1rem; }
        .req-info p { margin: 0; color: #666; font-size: 0.9rem; }

        .action-btn { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; color: white; margin-left: 5px; }
        .btn-approve { background-color: #28a745; } /* Keep Green for Success */
        .btn-deny { background-color: #dc3545; } /* Keep Red for Danger */
        .btn-approve:hover { background-color: #218838; }
        .btn-deny:hover { background-color: #c82333; }

        /* --- MODAL (POP OUT) STYLING --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: white; padding: 25px; border-radius: 8px; width: 50%; max-width: 600px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; border-top: 5px solid #ffc107;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
        .close-btn { cursor: pointer; font-size: 1.5rem; color: #aaa; }
        .close-btn:hover { color: #333; }

        .data-list { list-style: none; padding: 0; margin: 0; max-height: 300px; overflow-y: auto; }
        .data-list li { padding: 10px 0; border-bottom: 1px solid #f1f1f1; font-size: 0.95rem; color: #555; display: flex; align-items: center; }
        .avatar { width: 35px; height: 35px; background-color: #fff3cd; color: #856404; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 0.8rem; font-weight: bold; }

        /* --- AGENDA (DYNAMIC CALENDAR) STYLING --- */
        .agenda-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .calendar-header { display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center; }
        .calendar-nav button { background: #fff3cd; border: 1px solid #ffeeba; padding: 5px 15px; cursor: pointer; border-radius: 4px; color: #856404; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; text-align: center; }
        .day-name { font-weight: bold; color: #555; padding: 10px 0; }
        .calendar-day { height: 100px; border: 1px solid #eee; padding: 5px; position: relative; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: flex-start; }

        /* Calendar Hovers and Active States */
        .calendar-day:hover { background-color: #fff9db; border-color: #ffc107; }
        .day-number { font-weight: bold; font-size: 0.9rem; margin-bottom: 5px; width: 100%; text-align: right; color: #666;}
        .calendar-day.padding { background-color: #fcfcfc; cursor: default; }
        .calendar-day.current-day { background-color: #fff3cd; border: 1px solid #ffc107; }

        .event-badge { background-color: #ffc107; color: #212529; font-size: 0.7rem; padding: 3px 5px; border-radius: 3px; margin-bottom: 2px; width: 90%; text-align: left; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: bold; }

        /* --- FORM STYLING --- */
        .form-card { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); max-width: 800px; margin: 0 auto; border-top: 3px solid #ffc107; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 1rem; box-sizing: border-box; }
        .form-control:focus { border-color: #ffc107; outline: none; }

        .btn-submit { background-color: #ffc107; color: #212529; padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; font-weight: bold; }
        .btn-submit:hover { background-color: #e0a800; }

        .btn-submit.urgent { background-color: #dc3545; color: white;}
        .btn-delete { background-color: #dc3545; color: white; padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; margin-left: 10px; display: none; }

    </style>
</head>
<body>

<div class="wrapper">

    <aside class="sidebar">
        <div class="brand-logo">
            <img src="aiinfo.webp" alt="AI Infotech Logo" class="sidebar-logo">
        </div>

        <ul class="nav-links">
            <li><a onclick="showSection('dashboard')" class="active-link"><i class="fa-solid fa-gauge"></i> Dashboard</a></li>
            <li><a onclick="showSection('agenda')"><i class="fa-solid fa-calendar-days"></i> Agenda</a></li>
            <li><a onclick="showSection('emp-requests')"><i class="fa-solid fa-envelope-open-text"></i> Employees Request</a></li>
            <li><a onclick="showSection('attendance')"><i class="fa-solid fa-clipboard-user"></i> Attendance</a></li>
            <li>
                <details>
                    <summary><i class="fa-solid fa-bullhorn"></i> Announcements</summary>
                    <ul class="sub-menu">
                        <li><a onclick="showSection('announce-general')">General Announcement</a></li>
                        <li><a onclick="showSection('announce-urgent')">Urgent Announcement</a></li>
                    </ul>
                </details>
            </li>
        </ul>

        <div class="sidebar-footer">
            <a href="index.html" class="btn-logout">
                <i class="fa-solid fa-power-off"></i> &nbsp; Logout
            </a>
        </div>
    </aside>

    <main class="main-content">

        <div class="dashboard-top-bar">
            <div class="welcome-msg">
                <h2>Welcome, <strong>Admin</strong></h2>
                <p>Management Portal</p>
            </div>
            <div class="date-widget">
                <i class="fa-regular fa-calendar"></i>
                <span id="currentDate">Loading...</span>
            </div>
        </div>

        <div class="content-container">

            <div id="dashboard" class="section-view active">
                <h3>Dashboard Overview</h3>
                <br>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h4>Total Employees</h4>
                        <div class="count">124</div>
                        <button class="btn-view-more" onclick="openModal('modal-employees')">View More</button>
                    </div>
                    <div class="stat-card">
                        <h4>Today's Absentees</h4>
                        <div class="count" style="color: #dc3545;">4</div>
                        <button class="btn-view-more" onclick="openModal('modal-absentees')">View More</button>
                    </div>
                    <div class="stat-card">
                        <h4>Pending Requests</h4>
                        <div class="count" style="color: #d39e00;">8</div>
                        <button class="btn-view-more" onclick="showSection('emp-requests')">View More</button>
                    </div>
                </div>
            </div>

            <div id="agenda" class="section-view">
                <h3>Team Agenda</h3>
                <p style="color: #666; font-size: 0.9rem; margin-bottom: 10px;">Click on a day to add, edit, or delete an event.</p>

                <div class="agenda-card">
                    <div class="calendar-header">
                        <h2 id="monthYearDisplay">Month Year</h2>
                        <div class="calendar-nav">
                            <button onclick="changeMonth(-1)"><i class="fa-solid fa-chevron-left"></i> Prev</button>
                            <button onclick="changeMonth(1)">Next <i class="fa-solid fa-chevron-right"></i></button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>

            <div id="emp-requests" class="section-view">
                <h3>Employee Requests</h3>
                <br>

                <div class="req-card" id="req-1">
                    <div class="req-info">
                        <h5>Michael Brown</h5>
                        <p>Subject: Leave Application (Sick) - 2 Days</p>
                    </div>
                    <div>
                        <button class="action-btn btn-approve" onclick="approveRequest('req-1')">Approve</button>
                        <button class="action-btn btn-deny" onclick="openDenyModal('req-1')">Deny</button>
                    </div>
                </div>

                <div class="req-card" id="req-2">
                    <div class="req-info">
                        <h5>Emily Davis</h5>
                        <p>Subject: Expense Reimbursement ($120 Travel)</p>
                    </div>
                    <div>
                        <button class="action-btn btn-approve" onclick="approveRequest('req-2')">Approve</button>
                        <button class="action-btn btn-deny" onclick="openDenyModal('req-2')">Deny</button>
                    </div>
                </div>

                <div class="req-card" id="req-3">
                    <div class="req-info">
                        <h5>Chris Evans</h5>
                        <p>Subject: Equipment Request (New Monitor)</p>
                    </div>
                    <div>
                        <button class="action-btn btn-approve" onclick="approveRequest('req-3')">Approve</button>
                        <button class="action-btn btn-deny" onclick="openDenyModal('req-3')">Deny</button>
                    </div>
                </div>
            </div>

            <div id="attendance" class="section-view">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>Attendance Overview</h3>
                    <button class="btn-view-more" onclick="toggleAttendanceView()">Toggle Report View</button>
                </div>
                <br>

                <div id="attendance-daily">
                    <div class="two-col-grid">
                        <div class="list-box">
                            <h4 style="color: #28a745;">Present Today (120)</h4>
                            <ul class="data-list">
                                <li><span class="avatar">JD</span> John Doe</li>
                                <li><span class="avatar">AS</span> Alice Smith</li>
                                <li><span class="avatar">RJ</span> Robert Johnson</li>
                                <li><span class="avatar">MK</span> Maria Konovalova</li>
                                <li><span class="avatar">DL</span> David Lee</li>
                            </ul>
                        </div>
                        <div class="list-box">
                            <h4 style="color: #dc3545;">On Leave (4)</h4>
                            <ul class="data-list">
                                <li><span class="avatar" style="background:#f8d7da; color:#721c24;">MW</span> Mark Williams (Sick)</li>
                                <li><span class="avatar" style="background:#f8d7da; color:#721c24;">JL</span> Jennifer Lopez (Personal)</li>
                                <li><span class="avatar" style="background:#f8d7da; color:#721c24;">BK</span> Brian King (Absent)</li>
                                <li><span class="avatar" style="background:#f8d7da; color:#721c24;">TS</span> Taylor Scott (Sick)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="attendance-reports" style="display: none;">
                    <h4>Attendance Reports</h4>
                    <div class="report-grid">
                        <div class="report-card">
                            <h5>Weekly Attendance</h5>
                            <p>98%</p>
                            <span style="font-size: 0.8rem; color: green;">+2% from last week</span>
                        </div>
                        <div class="report-card">
                            <h5>Monthly Attendance</h5>
                            <p>95%</p>
                            <span style="font-size: 0.8rem; color: #ffc107;">Stable</span>
                        </div>
                        <div class="report-card">
                            <h5>Yearly Attendance</h5>
                            <p>92%</p>
                            <span style="font-size: 0.8rem; color: red;">-1% from last year</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="announce-general" class="section-view">
                <h3>Create General Announcement</h3>
                <br>
                <div class="form-card">
                    <div class="form-group">
                        <label>Title / Subject</label>
                        <input type="text" class="form-control" placeholder="e.g. Holiday Schedule">
                    </div>
                    <div class="form-group">
                        <label>Message Content</label>
                        <textarea class="form-control" rows="6" placeholder="Write your announcement here..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Audience</label>
                        <select class="form-control">
                            <option>All Employees</option>
                            <option>IT Department</option>
                            <option>HR Department</option>
                        </select>
                    </div>
                    <button class="btn-submit">Post Announcement</button>
                </div>
            </div>

            <div id="announce-urgent" class="section-view">
                <h3 style="color: #dc3545;"><i class="fa-solid fa-triangle-exclamation"></i> Create Urgent Announcement</h3>
                <br>
                <div class="form-card" style="border-top: 5px solid #dc3545;">
                    <div class="form-group">
                        <label>Title / Subject</label>
                        <input type="text" class="form-control" placeholder="e.g. SERVER MAINTENANCE - SAVE WORK">
                    </div>
                    <div class="form-group">
                        <label>Message Content</label>
                        <textarea class="form-control" rows="5" placeholder="State the urgency clearly..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Delivery Method</label>
                        <div style="margin-top: 10px;">
                            <input type="checkbox" checked> Email &nbsp;
                            <input type="checkbox" checked> SMS Alert &nbsp;
                            <input type="checkbox" checked> Dashboard Popup
                        </div>
                    </div>
                    <button class="btn-submit urgent">Post Announcement</button>
                </div>
            </div>

        </div>

    </main>
</div>

<div id="modal-employees" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Employee Directory</h3>
            <span class="close-btn" onclick="closeModal('modal-employees')">&times;</span>
        </div>
        <ul class="data-list">
            <li><span class="avatar">JD</span> John Doe - Developer</li>
            <li><span class="avatar">AS</span> Alice Smith - Designer</li>
            <li><span class="avatar">RJ</span> Robert Johnson - Manager</li>
        </ul>
    </div>
</div>

<div id="modal-absentees" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="color: #dc3545;">Absent Today</h3>
            <span class="close-btn" onclick="closeModal('modal-absentees')">&times;</span>
        </div>
        <ul class="data-list">
            <li><span class="avatar" style="background:#f8d7da; color:#721c24;">MW</span> Mark Williams - Sick Leave</li>
            <li><span class="avatar" style="background:#f8d7da; color:#721c24;">TS</span> Taylor Scott - Sick Leave</li>
        </ul>
    </div>
</div>

<div id="modal-add-event" class="modal-overlay">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h3 id="modalEventHeader">Manage Event</h3>
            <span class="close-btn" onclick="closeModal('modal-add-event')">&times;</span>
        </div>
        <div class="form-group">
            <label>Date</label>
            <input type="text" id="eventDate" class="form-control" readonly style="background-color: #eee;">
        </div>
        <div class="form-group">
            <label>Event Name</label>
            <input type="text" id="eventTitle" class="form-control" placeholder="Meeting, Holiday, etc.">
        </div>
        <div style="display: flex; justify-content: flex-end;">
            <button class="btn-submit" onclick="saveEvent()">Save</button>
            <button class="btn-delete" id="btnDeleteEvent" onclick="deleteEvent()">Delete</button>
        </div>
    </div>
</div>

<div id="modal-deny-req" class="modal-overlay">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3 style="color: #dc3545;">Deny Request</h3>
            <span class="close-btn" onclick="closeModal('modal-deny-req')">&times;</span>
        </div>
        <div class="form-group">
            <label>Reason for Denial</label>
            <textarea id="denyReason" class="form-control" rows="4" placeholder="Please provide a reason..."></textarea>
        </div>
        <button class="btn-submit urgent" onclick="submitDeny()">Confirm Denial</button>
    </div>
</div>

<script>
    // --- 1. Navigation Logic ---
    function showSection(sectionId) {
        const sections = document.querySelectorAll('.section-view');
        sections.forEach(section => section.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');

        // Visual feedback on sidebar
        const navLinks = document.querySelectorAll('.nav-links li a');
        navLinks.forEach(link => link.classList.remove('active-link'));
        // (Optional: simple way to highlight active link in vanilla JS prototype)
    }

    // --- 2. Modal Logic ---
    function openModal(modalId) { document.getElementById(modalId).style.display = 'flex'; }
    function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }

    window.onclick = function(event) {
        if (event.target.classList.contains('modal-overlay')) {
            event.target.style.display = 'none';
        }
    }

    // --- 3. Live Header Date Logic ---
    function updateLiveDate() {
        const dateElement = document.getElementById('currentDate');
        const today = new Date();
        const options = { day: 'numeric', month: 'long', year: 'numeric' };
        dateElement.innerText = today.toLocaleDateString('en-GB', options);
    }
    updateLiveDate();

    // --- 4. Calendar Logic (Add, Edit, Delete) ---
    let nav = 0;
    let clickedDate = null;
    let events = [];

    const calendarGrid = document.getElementById('calendarGrid');
    const monthYearDisplay = document.getElementById('monthYearDisplay');
    const weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

    function loadCalendar() {
        const dt = new Date();
        if (nav !== 0) dt.setMonth(new Date().getMonth() + nav);

        const day = dt.getDate();
        const month = dt.getMonth();
        const year = dt.getFullYear();

        const firstDayOfMonth = new Date(year, month, 1);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const paddingDays = new Date(year, month, 1).getDay();

        monthYearDisplay.innerText = `${dt.toLocaleDateString('en-us', { month: 'long' })} ${year}`;
        calendarGrid.innerHTML = '';

        weekDays.forEach(day => {
            const daySquare = document.createElement('div');
            daySquare.classList.add('day-name');
            daySquare.innerText = day;
            calendarGrid.appendChild(daySquare);
        });

        for(let i = 0; i < paddingDays; i++) {
            const paddingSquare = document.createElement('div');
            paddingSquare.classList.add('calendar-day', 'padding');
            calendarGrid.appendChild(paddingSquare);
        }

        for(let i = 1; i <= daysInMonth; i++) {
            const daySquare = document.createElement('div');
            daySquare.classList.add('calendar-day');
            const dayString = `${month + 1}/${i}/${year}`;

            const todayObj = new Date();
            if (i === todayObj.getDate() && nav === 0 && month === todayObj.getMonth() && year === todayObj.getFullYear()) {
                daySquare.classList.add('current-day');
            }

            const dayNum = document.createElement('div');
            dayNum.classList.add('day-number');
            dayNum.innerText = i;
            daySquare.appendChild(dayNum);

            // Find existing event
            const dayEvent = events.find(e => e.date === dayString);
            if (dayEvent) {
                const eventDiv = document.createElement('div');
                eventDiv.classList.add('event-badge');
                eventDiv.innerText = dayEvent.title;
                daySquare.appendChild(eventDiv);
            }

            daySquare.addEventListener('click', () => openEventModal(dayString));
            calendarGrid.appendChild(daySquare);
        }
    }

    function changeMonth(direction) {
        nav += direction;
        loadCalendar();
    }

    function openEventModal(dateStr) {
        clickedDate = dateStr;
        document.getElementById('eventDate').value = dateStr;

        // Check if event exists
        const existingEvent = events.find(e => e.date === dateStr);
        const deleteBtn = document.getElementById('btnDeleteEvent');

        if (existingEvent) {
            document.getElementById('eventTitle').value = existingEvent.title;
            deleteBtn.style.display = 'block'; // Show delete button
        } else {
            document.getElementById('eventTitle').value = '';
            deleteBtn.style.display = 'none'; // Hide delete button
        }

        openModal('modal-add-event');
    }

    function saveEvent() {
        const title = document.getElementById('eventTitle').value;
        if (title) {
            // Check if exists, update index, or push new
            const existingIndex = events.findIndex(e => e.date === clickedDate);
            if (existingIndex > -1) {
                events[existingIndex].title = title; // Update
            } else {
                events.push({ date: clickedDate, title: title }); // Add
            }
            closeModal('modal-add-event');
            loadCalendar();
        }
    }

    function deleteEvent() {
        events = events.filter(e => e.date !== clickedDate);
        closeModal('modal-add-event');
        loadCalendar();
    }

    // --- 5. Attendance View Toggle ---
    let isReportView = false;
    function toggleAttendanceView() {
        const daily = document.getElementById('attendance-daily');
        const reports = document.getElementById('attendance-reports');
        isReportView = !isReportView;

        if(isReportView) {
            daily.style.display = 'none';
            reports.style.display = 'block';
        } else {
            daily.style.display = 'block';
            reports.style.display = 'none';
        }
    }

    // --- 6. Employee Request Logic ---
    let currentReqId = null;

    function approveRequest(id) {
        alert("Request Approved");
        document.getElementById(id).style.display = 'none';
    }

    function openDenyModal(id) {
        currentReqId = id;
        document.getElementById('denyReason').value = '';
        openModal('modal-deny-req');
    }

    function submitDeny() {
        const reason = document.getElementById('denyReason').value;
        if(reason.trim() === "") {
            alert("Please enter a reason.");
            return;
        }
        alert("Request Denied. Reason: " + reason);
        document.getElementById(currentReqId).style.display = 'none';
        closeModal('modal-deny-req');
    }

    // Initialize
    loadCalendar();

</script>

</body>
</html>