<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Dashboard - AI Infotech</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- General Reset --- */
        body, html { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; height: 100%; background-color: #f4f6f9; }
        .wrapper { display: flex; height: 100vh; width: 100%; }

        /* --- SIDEBAR --- */
        .sidebar { width: 260px; background-color: #212529; color: #ffffff; display: flex; flex-direction: column; flex-shrink: 0; height: 100vh; }
        .brand-logo { padding: 20px; text-align: center; background-color: #1a1e21; border-bottom: 1px solid #32383e; border-left: 5px solid #ffc107; }
        .sidebar-logo { max-width: 100%; height: auto; width: 180px; display: block; margin: 0 auto; }
        
        .nav-links { list-style: none; padding: 0; margin: 20px 0; flex-grow: 1; overflow-y: auto; }
        .nav-links li a, .nav-links summary { display: block; padding: 15px 20px; color: #adb5bd; text-decoration: none; transition: 0.3s; cursor: pointer; font-size: 1rem; }
        .nav-links li a:hover, .nav-links summary:hover, .nav-links li a.active-link { background-color: #ffc107; color: #212529; font-weight: 600; }
        .nav-links i { width: 25px; text-align: center; margin-right: 10px; }
        
        details summary { list-style: none; outline: none; }
        details summary::after { content: '\25BC'; float: right; font-size: 0.8em; margin-top: 5px; }
        details[open] summary::after { content: '\25B2'; }
        .sub-menu { background-color: #32383e; padding-left: 0; margin: 0; list-style: none; }
        .sub-menu a { padding-left: 55px !important; font-size: 0.9rem; border-left: 3px solid transparent; }
        .sub-menu a:hover { border-left-color: #ffc107; }

        .sidebar-footer { padding: 20px; border-top: 1px solid #32383e; background-color: #1a1e21; }
        .btn-logout { display: flex; align-items: center; justify-content: center; width: 100%; padding: 12px 0; background-color: transparent; color: #dc3545; border: 1px solid #dc3545; border-radius: 5px; text-decoration: none; font-weight: bold; transition: 0.3s; }
        .btn-logout:hover { background-color: #dc3545; color: white; }

        /* --- MAIN CONTENT --- */
        .main-content { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; }
        .dashboard-top-bar { background-color: white; padding: 20px 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #ffc107; }
        .welcome-msg h2 { margin: 0; font-size: 1.4rem; color: #333; }
        .welcome-msg p { margin: 5px 0 0 0; color: #666; font-size: 0.95rem; }
        .date-widget { background-color: #fff9db; padding: 10px 20px; border-radius: 50px; border: 1px solid #ffeeba; display: flex; align-items: center; color: #856404; font-weight: 600; }
        .date-widget i { color: #d39e00; margin-right: 10px; }

        .content-container { padding: 30px; }
        .section-view { display: none; animation: fadeIn 0.3s ease-in-out; }
        .section-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Dashboard Grid */
        .dashboard-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; margin-bottom: 25px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-top: 4px solid #ffc107; text-align: center; }
        .stat-card h4 { margin: 0; color: #666; font-size: 1rem; text-transform: uppercase; }
        .stat-card .count { font-size: 2.5rem; margin: 10px 0; color: #333; font-weight: bold; }
        
        .btn-view-more { background-color: #ffc107; color: #212529; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: background 0.2s; }
        .btn-view-more:hover { background-color: #e0a800; }

        /* Lists & Tables */
        .two-col-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .list-box { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .list-box h4 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        
        /* Employee Report Table */
        .report-table-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .styled-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .styled-table thead tr { background-color: #f8f9fa; text-align: left; }
        .styled-table th, .styled-table td { padding: 12px 15px; border-bottom: 1px solid #eee; }
        .styled-table tbody tr:hover { background-color: #fff9db; }

        /* Report Cards */
        .report-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 20px; }
        .report-card { background: #fff; padding: 20px; border-radius: 8px; text-align: center; border: 1px solid #eee; }
        .report-card h5 { margin: 0; color: #666; }
        .report-card p { font-size: 1.5rem; font-weight: bold; color: #333; margin: 10px 0; }

        /* Requests */
        .req-card { background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #ffc107; }
        .action-btn { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; color: white; margin-left: 5px; }
        .btn-approve { background-color: #28a745; }
        .btn-deny { background-color: #dc3545; }

        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 25px; border-radius: 8px; width: 50%; max-width: 600px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; border-top: 5px solid #ffc107; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
        .close-btn { cursor: pointer; font-size: 1.5rem; color: #aaa; }
        
        .data-list { list-style: none; padding: 0; margin: 0; max-height: 300px; overflow-y: auto; }
        .data-list li { padding: 10px 0; border-bottom: 1px solid #f1f1f1; display: flex; align-items: center; }
        .avatar { width: 35px; height: 35px; background-color: #fff3cd; color: #856404; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold; }

        /* Calendar */
        .agenda-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .calendar-header { display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center; }
        .calendar-nav button { background: #fff3cd; border: 1px solid #ffeeba; padding: 5px 15px; cursor: pointer; border-radius: 4px; color: #856404; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; text-align: center; }
        .day-name { font-weight: bold; color: #555; padding: 10px 0; }
        .calendar-day { height: 100px; border: 1px solid #eee; padding: 5px; position: relative; cursor: pointer; display: flex; flex-direction: column; align-items: flex-start; }
        .calendar-day:hover { background-color: #fff9db; border-color: #ffc107; }
        .calendar-day.current-day { background-color: #fff3cd; border: 1px solid #ffc107; }
        .event-badge { background-color: #ffc107; color: #212529; font-size: 0.7rem; padding: 3px 5px; border-radius: 3px; margin-bottom: 2px; width: 90%; text-align: left; font-weight: bold; }

        /* Forms */
        .form-card { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); max-width: 800px; margin: 0 auto; border-top: 3px solid #ffc107; }
        .form-group { margin-bottom: 20px; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .btn-submit { background-color: #ffc107; color: #212529; padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-submit.urgent { background-color: #dc3545; color: white;}
        .btn-delete { background-color: #dc3545; color: white; padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px; display: none; }
        
        /* Utility */
        .spinner { font-size: 2rem; color: #ffc107; text-align: center; display: block; margin: 20px auto; }
    </style>
</head>
<body>

<div class="wrapper">

    <aside class="sidebar">
        <div class="brand-logo">
            <img src="aiinfo.webp" alt="AI Infotech Logo" class="sidebar-logo">
        </div>

        <ul class="nav-links">
            <li><a onclick="showSection('dashboard')" class="active-link"><i class="fa-solid fa-gauge"></i> Dashboard</a></li>
            <li><a onclick="showSection('agenda')"><i class="fa-solid fa-calendar-days"></i> Agenda</a></li>
            <li><a onclick="showSection('emp-requests')"><i class="fa-solid fa-envelope-open-text"></i> Employees Request</a></li>
            
            <li>
                <details open>
                    <summary><i class="fa-solid fa-clipboard-user"></i> Attendance</summary>
                    <ul class="sub-menu">
                        <li><a onclick="showSection('attendance-overview')">Overview</a></li>
                        <li><a onclick="showSection('attendance-sheet')">Employee Sheet DB</a></li>
                    </ul>
                </details>
            </li>

            <li>
                <details>
                    <summary><i class="fa-solid fa-bullhorn"></i> Announcements</summary>
                    <ul class="sub-menu">
                        <li><a onclick="showSection('announce-general')">General Announcement</a></li>
                        <li><a onclick="showSection('announce-urgent')">Urgent Announcement</a></li>
                    </ul>
                </details>
            </li>
        </ul>

        <div class="sidebar-footer">
            <a href="index.html" class="btn-logout">
                <i class="fa-solid fa-power-off"></i> &nbsp; Logout
            </a>
        </div>
    </aside>

    <main class="main-content">

        <div class="dashboard-top-bar">
            <div class="welcome-msg">
                <h2>Welcome, <strong>Admin</strong></h2>
                <p>Management Portal</p>
            </div>
            <div class="date-widget">
                <i class="fa-regular fa-calendar"></i>
                <span id="currentDate">Loading...</span>
            </div>
        </div>

        <div class="content-container">

            <div id="dashboard" class="section-view active">
                <h3>Dashboard Overview</h3>
                <br>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h4>Total Employees</h4>
                        <div class="count">124</div>
                        <button class="btn-view-more" onclick="openModal('modal-employees')">View More</button>
                    </div>
                    <div class="stat-card">
                        <h4>Today's Absentees</h4>
                        <div class="count" style="color: #dc3545;">4</div>
                        <button class="btn-view-more" onclick="openModal('modal-absentees')">View More</button>
                    </div>
                    <div class="stat-card">
                        <h4>Pending Requests</h4>
                        <div class="count" style="color: #d39e00;">8</div>
                        <button class="btn-view-more" onclick="showSection('emp-requests')">View More</button>
                    </div>
                </div>
            </div>

            <div id="agenda" class="section-view">
                <h3>Team Agenda</h3>
                <div class="agenda-card">
                    <div class="calendar-header">
                        <h2 id="monthYearDisplay">Month Year</h2>
                        <div class="calendar-nav">
                            <button onclick="changeMonth(-1)">Prev</button>
                            <button onclick="changeMonth(1)">Next</button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>

            <div id="emp-requests" class="section-view">
                <h3>Employee Requests</h3>
                <br>
                <div class="req-card" id="req-1">
                    <div class="req-info"><h5>Michael Brown</h5><p>Subject: Leave Application (Sick) - 2 Days</p></div>
                    <div><button class="action-btn btn-approve" onclick="approveRequest('req-1')">Approve</button><button class="action-btn btn-deny" onclick="openDenyModal('req-1')">Deny</button></div>
                </div>
            </div>

            <div id="attendance-overview" class="section-view">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>Attendance Overview</h3>
                    <button class="btn-view-more" id="toggleReportBtn" onclick="toggleAttendanceView()">View Reports</button>
                </div>
                <br>

                <div id="attendance-daily">
                    <div class="two-col-grid">
                        <div class="list-box">
                            <h4 style="color: #28a745;">Present Today (120)</h4>
                            <ul class="data-list">
                                <li><span class="avatar">JD</span> John Doe</li>
                                <li><span class="avatar">AS</span> Alice Smith</li>
                            </ul>
                        </div>
                        <div class="list-box">
                            <h4 style="color: #dc3545;">On Leave (4)</h4>
                            <ul class="data-list">
                                <li><span class="avatar" style="background:#f8d7da; color:#721c24;">MW</span> Mark Williams (Sick)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="attendance-reports" style="display: none;">
                    <h4>Statistical Reports</h4>
                    <div class="report-grid">
                        <div class="report-card"><h5>Weekly Attendance</h5><p>98%</p><span style="font-size: 0.8rem; color: green;">+2% from last week</span></div>
                        <div class="report-card"><h5>Monthly Attendance</h5><p>95%</p><span style="font-size: 0.8rem; color: #ffc107;">Stable</span></div>
                        <div class="report-card"><h5>Yearly Attendance</h5><p>92%</p><span style="font-size: 0.8rem; color: red;">-1% from last year</span></div>
                    </div>
                </div>
            </div>

            <div id="attendance-sheet" class="section-view">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>Employee Attendance Sheet (Live)</h3>
                    <button class="btn-view-more" onclick="downloadCSV()"><i class="fa-solid fa-file-excel"></i> Download CSV</button>
                </div>
                <p style="color: #666; margin-bottom: 20px;">Fetching data directly from Google Sheets</p>
                
                <div class="report-table-container">
                    <i id="sheetSpinner" class="fa-solid fa-spinner fa-spin spinner"></i>
                    <table class="styled-table" id="sheetTable" style="display: none;">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>In Time</th>
                                <th>Out Time</th>
                                <th>Working Period</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="sheetBody">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="announce-general" class="section-view">
                <h3>Create General Announcement</h3>
                <div class="form-card">
                    <div class="form-group"><label>Message Content</label><textarea class="form-control" rows="4"></textarea></div>
                    <button class="btn-submit">Post Announcement</button>
                </div>
            </div>

            <div id="announce-urgent" class="section-view">
                <h3 style="color: #dc3545;">Create Urgent Announcement</h3>
                <div class="form-card" style="border-top: 5px solid #dc3545;">
                    <div class="form-group"><label>Message Content</label><textarea class="form-control" rows="4"></textarea></div>
                    <button class="btn-submit urgent">Post Announcement</button>
                </div>
            </div>

        </div>
    </main>
</div>

<div id="modal-employees" class="modal-overlay"><div class="modal-content"><span class="close-btn" onclick="closeModal('modal-employees')">&times;</span><h3>Employee Directory</h3><ul class="data-list"><li><span class="avatar">JD</span> John Doe</li></ul></div></div>
<div id="modal-absentees" class="modal-overlay"><div class="modal-content"><span class="close-btn" onclick="closeModal('modal-absentees')">&times;</span><h3 style="color:#dc3545">Absent Today</h3><ul class="data-list"><li><span class="avatar" style="background:#f8d7da; color:#721c24;">MW</span> Mark Williams</li></ul></div></div>
<div id="modal-deny-req" class="modal-overlay"><div class="modal-content"><span class="close-btn" onclick="closeModal('modal-deny-req')">&times;</span><h3 style="color:#dc3545">Deny Request</h3><textarea id="denyReason" class="form-control" rows="4"></textarea><br><button class="btn-submit urgent" onclick="submitDeny()">Confirm</button></div></div>

<div id="modal-add-event" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header"><h3 id="modalEventHeader">Manage Event</h3><span class="close-btn" onclick="closeModal('modal-add-event')">&times;</span></div>
        <div class="form-group"><label>Date</label><input type="text" id="eventDate" class="form-control" readonly></div>
        <div class="form-group"><label>Event Name</label><input type="text" id="eventTitle" class="form-control"></div>
        <div style="display: flex; justify-content: flex-end;">
            <button class="btn-submit" onclick="saveEvent()">Save</button>
            <button class="btn-delete" id="btnDeleteEvent" onclick="deleteEvent()">Delete</button>
        </div>
    </div>
</div>

<script>
    // --- 1. Navigation Logic ---
    const SHEET_API_URL = "https://sheetdb.io/api/v1/arh117tr3hvvy";

    function showSection(sectionId) {
        document.querySelectorAll('.section-view').forEach(s => s.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
        document.querySelectorAll('.nav-links a').forEach(l => l.classList.remove('active-link'));
        if(sectionId === 'attendance-sheet') { loadSheetData(); }
    }

    // --- 2. Live Date ---
    document.getElementById('currentDate').innerText = new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });

    // --- 3. Attendance Toggle Logic (FIXED: BUTTON REMAINS YELLOW) ---
    let isReportView = false;
    function toggleAttendanceView() {
        const daily = document.getElementById('attendance-daily');
        const reports = document.getElementById('attendance-reports');
        const btn = document.getElementById('toggleReportBtn');
        isReportView = !isReportView;

        if(isReportView) {
            daily.style.display = 'none';
            reports.style.display = 'block';
            btn.innerText = "Back to List"; 
            // Note: We removed the style overrides so it keeps the default yellow class style
        } else {
            daily.style.display = 'block';
            reports.style.display = 'none';
            btn.innerText = "View Reports";
        }
    }

    // --- 4. Fetch Sheet Data ---
    function loadSheetData() {
        const table = document.getElementById('sheetTable');
        const tbody = document.getElementById('sheetBody');
        const spinner = document.getElementById('sheetSpinner');

        table.style.display = 'none';
        spinner.style.display = 'block';
        tbody.innerHTML = '';

        fetch(SHEET_API_URL)
        .then(response => response.json())
        .then(data => {
            spinner.style.display = 'none';
            table.style.display = 'table';
            data.forEach(row => {
                if(row.Date || row.InTime) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${row.Date || '-'}</td><td>${row.InTime || '-'}</td><td>${row.OutTime || '-'}</td><td>${row.WorkingPeriod || '-'}</td><td><span class="event-badge">${row.Action || '-'}</span></td>`;
                    tbody.appendChild(tr);
                }
            });
        })
        .catch(error => {
            spinner.style.display = 'none';
            tbody.innerHTML = '<tr><td colspan="5" style="color:red; text-align:center;">Failed to load data.</td></tr>';
            table.style.display = 'table';
        });
    }

    // --- 5. Download CSV Logic ---
    function downloadCSV() {
        const rows = document.querySelectorAll("#sheetTable tr");
        if(rows.length <= 1) { alert("No data to download!"); return; }
        let csvContent = "data:text/csv;charset=utf-8,";
        rows.forEach(row => {
            const cols = row.querySelectorAll("td, th");
            let rowData = [];
            cols.forEach(col => rowData.push(col.innerText));
            csvContent += rowData.join(",") + "\r\n";
        });
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "attendance_report.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // --- 6. Calendar & Modal Logic ---
    let nav = 0; let clickedDate = null; let events = [];
    const calendarGrid = document.getElementById('calendarGrid');
    
    function loadCalendar() {
        const dt = new Date();
        if (nav !== 0) dt.setMonth(new Date().getMonth() + nav);
        const month = dt.getMonth();
        const year = dt.getFullYear();
        const firstDay = new Date(year, month, 1);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const padding = firstDay.getDay();

        document.getElementById('monthYearDisplay').innerText = dt.toLocaleDateString('en-us', { month: 'long', year: 'numeric' });
        calendarGrid.innerHTML = '';
        ['S','M','T','W','T','F','S'].forEach(d => {
            const div = document.createElement('div'); div.classList.add('day-name'); div.innerText = d; calendarGrid.appendChild(div);
        });
        for(let i=0; i<padding; i++) { const div = document.createElement('div'); div.classList.add('calendar-day','padding'); calendarGrid.appendChild(div); }
        for(let i=1; i<=daysInMonth; i++) {
            const div = document.createElement('div'); div.classList.add('calendar-day');
            div.innerHTML = `<div class="day-number">${i}</div>`;
            const dateStr = `${month+1}/${i}/${year}`;
            const ev = events.find(e => e.date === dateStr);
            if(ev) div.innerHTML += `<div class="event-badge">${ev.title}</div>`;
            div.onclick = () => openEventModal(dateStr);
            calendarGrid.appendChild(div);
        }
    }
    
    function changeMonth(d) { nav += d; loadCalendar(); }
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function openEventModal(d) { clickedDate = d; document.getElementById('eventDate').value = d; openModal('modal-add-event'); }
    function saveEvent() { events.push({date: clickedDate, title: document.getElementById('eventTitle').value}); closeModal('modal-add-event'); loadCalendar(); }
    function deleteEvent() { closeModal('modal-add-event'); }
    
    function approveRequest(id) { document.getElementById(id).style.display = 'none'; alert("Request Approved"); }
    function openDenyModal(id) { window.currentReqId = id; document.getElementById('denyReason').value = ''; openModal('modal-deny-req'); }
    function submitDeny() { alert("Request Denied."); document.getElementById(window.currentReqId).style.display = 'none'; closeModal('modal-deny-req'); }

    loadCalendar();
</script>

</body>
</html>
